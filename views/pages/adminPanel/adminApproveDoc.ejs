<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>admin Approve Doctors</title>

  <link rel="stylesheet" href="/fontawesome-free-6.5.2-web/css/all.min.css">
  <link rel="stylesheet" href="/css/sideBar/newSidebar.css">
  <link rel="stylesheet" href="/css/adminPanel/adminApproveDoc.css">

</head>

<body>

  <%- include('../../common/newSidebar/adminSidebar.ejs') %>

    <div class="a2-approve-table-div">
      <div class="container">
        <a href="/admin" style="text-decoration: none; color: black;">
          <p class="a2-back-btn a2-btn"><img src="/assets/adminPanel/icons/back-iceblue.svg" alt="Back"> Back</p>
        </a>

        <div class="doctor-panel">
          <h2 class="a2-approve-h2">New Doctors</h2>
          <h2 class="a2-all-doctors-panel">All Doctors</h2>
        </div>
        <div class="pending-doctors">

          <h4 class="a2-approve-h4">Pending Request <span id="total-pending-doc"></span></h4>

          <table class="a2-approve-table">
            <tr class="approve-tbl-head">

              <th>ID</th>
              <th>Doctor Name</th>
              <th>Email</th>
              <th>qualification</th>
              <th>Status</th>

            </tr>

            <tbody id="approve-tbl-body"></tbody>

          </table>
        </div>

        <div class="all-doctors">
          <h4 class="a2-approve-h4">All Doctors <span id="all-doctors-count"></span></h4>

          <table class="a2-approve-table">
            <tr class="approve-tbl-head">

              <th>ID</th>
              <th>Doctor Name</th>
              <th>Email</th>
              <th>Qualification</th>
              <th>Status</th>

            </tr>

            <tbody id="get-all-doctors"></tbody>

          </table>
        </div>

      </div>
    </div>



    <script>
      const requestH2 = document.querySelector('.a2-approve-h2');
      const allDoctorsH2 = document.querySelector('.a2-all-doctors-panel');

      const requestDiv = document.querySelector('.pending-doctors');
      const allDoctorsDiv = document.querySelector('.all-doctors');

      allDoctorsDiv.style.display = 'none';

      requestH2.addEventListener('click', () => {

        allDoctorsDiv.style.display = 'none';
        requestDiv.style.display = 'block';
      });

      allDoctorsH2.addEventListener('click', () => {

        requestDiv.style.display = 'none';
        allDoctorsDiv.style.display = 'block';

      });

    </script>

    <script>

      async function getPendingDoc() {

        let resp = await fetch('/get-pending-doctor');

        let allPendingDoctors = await resp.json();
        document.getElementById('total-pending-doc').innerHTML = `(${allPendingDoctors.length})`


        const tbody = document.getElementById('approve-tbl-body');
        allPendingDoctors.forEach(doc => {

          let str = `<tr>
            <td>${doc.id}</td>
            <td>${doc.doctor_name}</td>
            <td>${doc.email}</td>
            <td>${doc.qualification}</td>
            <td class="a2-btn" onclick="approveDoc(${doc.id})">Approve</td>
          </tr>`;

          tbody.innerHTML += str
        });
      }

      getPendingDoc()

      async function approveDoc(id) {
        location.href = `/individual-doctor/${id}`;
      }
    </script>

    <script>

      async function getAllDoctors() {

        const resp = await fetch('/get-all-doctors');

        const data = await resp.json();

        document.getElementById('all-doctors-count').innerHTML = ` (${data.length})`
        const tbody = document.getElementById('get-all-doctors');

        data.forEach(doc => {
          let tds = `<tr>
          <td>${doc.doctor_id}</td>
          <td>${doc.fname} ${doc.lname}</td>
          <td>${doc.email}</td>
          <td>${doc.qualification}</td>
          <td><p class="a2-btn" onclick="deleteDoctor(${doc.doctor_id})">Delete</p></td>
          </tr>`;

          tbody.innerHTML += tds;
        });



      }
      getAllDoctors()



      async function deleteDoctor(id) {
        let resp = await fetch(`/delete-doctor/${id}`);
        location.reload()
      }


    </script>

</body>

</html>